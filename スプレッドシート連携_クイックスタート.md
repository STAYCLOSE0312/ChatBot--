# Googleスプレッドシート連携 クイックスタートガイド

## 🚀 5ステップで実装開始

### ステップ1: Google Cloud Platformの設定（10分）

1. **Google Cloud Consoleにアクセス**
   ```
   https://console.cloud.google.com/
   ```

2. **新しいプロジェクトを作成**
   - プロジェクト名: `chatbot-sheets-api`（任意）
   - 「作成」をクリック

3. **Google Sheets APIを有効化**
   - 「APIとサービス」→「ライブラリ」
   - 「Google Sheets API」を検索
   - 「有効にする」をクリック

4. **サービスアカウントを作成**
   - 「APIとサービス」→「認証情報」
   - 「認証情報を作成」→「サービスアカウント」
   - サービスアカウント名を入力して「作成」
   - 「キーを追加」→「新しいキーを作成」→「JSON」を選択
   - **ダウンロードしたJSONファイルを保存**（重要！）

### ステップ2: スプレッドシートの準備（5分）

1. **新しいスプレッドシートを作成**
   - Googleドライブで新規作成
   - 名前: `チャットボットFAQ管理`

2. **シートを準備**
   - シート1: 名前を「FAQ」に変更
   - シート2: 追加して名前を「History」に変更
   - シート3: 追加して名前を「Settings」に変更

3. **ヘッダー行を設定**

   **FAQシート（1行目）:**
   ```
   ID	質問	回答	キーワード	作成日時	更新日時	使用回数	カテゴリ
   ```

   **Historyシート（1行目）:**
   ```
   日時	質問	回答	FAQ_ID	ユーザーID	セッションID	満足度	備考
   ```

4. **サービスアカウントに共有**
   - スプレッドシートの「共有」ボタンをクリック
   - JSONファイル内の `client_email` の値をコピー
   - そのメールアドレスを追加（権限: 編集者）
   - スプレッドシートIDをコピー（URLの `/d/` と `/edit` の間）

### ステップ3: プロジェクトの設定（5分）

1. **パッケージのインストール**
   ```bash
   npm install googleapis dotenv
   ```

2. **credentialsフォルダを作成**
   ```bash
   mkdir credentials
   ```

3. **JSONキーファイルを配置**
   - ダウンロードしたJSONファイルを `credentials/google-service-account.json` に配置

4. **`.env` ファイルを作成**（プロジェクトルート）
   ```env
   GOOGLE_SHEETS_SPREADSHEET_ID=ここにスプレッドシートIDを貼り付け
   GOOGLE_SERVICE_ACCOUNT_PATH=./credentials/google-service-account.json
   PORT=3000
   ```

5. **`.gitignore` に追加**（まだ追加していない場合）
   ```
   .env
   credentials/
   node_modules/
   ```

### ステップ4: コードの実装（15分）

詳細は `スプレッドシート連携_設計資料.md` を参照してください。

主な変更点:
1. `lib/googleSheets.js` を作成（Google Sheets API連携モジュール）
2. `server.js` を修正（JSONファイルの代わりにGoogle Sheetsを使用）
3. 履歴保存機能を追加

### ステップ5: 動作確認（5分）

1. **サーバーを起動**
   ```bash
   npm start
   ```

2. **チャットボットにアクセス**
   ```
   http://localhost:3000/chatbot.html
   ```

3. **質問を送信してテスト**
   - 質問を入力
   - 回答が返ってくることを確認
   - スプレッドシートの「History」シートに履歴が追加されているか確認

4. **FAQ管理画面でFAQを追加**
   ```
   http://localhost:3000/admin.html
   ```
   - 新しいFAQを追加
   - スプレッドシートの「FAQ」シートに追加されているか確認

---

## ✅ チェックリスト

実装前の確認:

- [ ] Google Cloud Platformアカウントを作成
- [ ] プロジェクトを作成
- [ ] Google Sheets APIを有効化
- [ ] サービスアカウントを作成
- [ ] サービスアカウントキー（JSON）をダウンロード
- [ ] スプレッドシートを作成
- [ ] シート（FAQ、History、Settings）を作成
- [ ] ヘッダー行を設定
- [ ] サービスアカウントに共有権限を付与
- [ ] スプレッドシートIDを取得

実装時の確認:

- [ ] `googleapis` と `dotenv` をインストール
- [ ] `credentials` フォルダを作成
- [ ] JSONキーファイルを配置
- [ ] `.env` ファイルを作成
- [ ] 環境変数を設定
- [ ] `.gitignore` に追加
- [ ] `lib/googleSheets.js` を作成
- [ ] `server.js` を修正
- [ ] サーバーが起動する
- [ ] チャットボットが動作する
- [ ] 履歴が保存される
- [ ] FAQが追加・更新できる

---

## 🔧 トラブルシューティング

### エラー: "認証情報が見つかりません"

**解決方法:**
1. `.env` ファイルの `GOOGLE_SERVICE_ACCOUNT_PATH` を確認
2. JSONファイルが正しい場所にあるか確認
3. パスが正しいか確認（相対パスまたは絶対パス）

### エラー: "権限がありません"

**解決方法:**
1. スプレッドシートの「共有」設定を確認
2. サービスアカウントのメールアドレスが追加されているか確認
3. 権限が「編集者」になっているか確認

### エラー: "APIが有効になっていません"

**解決方法:**
1. Google Cloud Consoleで「APIとサービス」→「ライブラリ」を確認
2. 「Google Sheets API」を検索
3. 「有効にする」をクリック

---

## 📚 次のステップ

基本実装が完了したら、以下を検討してください:

1. **AI連携**: OpenAI/Claude APIでFAQ自動生成
2. **分析機能**: 履歴データからよくある質問を抽出
3. **承認フロー**: AI生成FAQを管理者が承認
4. **レポート機能**: 日次・週次レポートの生成

詳細は `スプレッドシート連携_設計資料.md` を参照してください。

---

**作成日**: 2025年1月
